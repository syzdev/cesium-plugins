class t{constructor(t,e){this.Cesium=t,this.viewer=e,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.canvas)}pick(t,e=!0){const i=this.Cesium,s=this.viewer;this.handler.setInputAction((r=>{const a=s.scene.globe.pick(s.camera.getPickRay(r.position),s.scene);if(a){const r=s.scene.globe.ellipsoid.cartesianToCartographic(a),o=i.Math.toDegrees(r.latitude),n=i.Math.toDegrees(r.longitude),l=r.height;e&&function(t,e="14px",i="#292421",s="#B6D5F1"){let r="";if(Array.isArray(t)){for(let e=0;e<t.length;e++)r+=t[e]+"\n";r=r.slice(0,r.length-1)}else r=t;console.log(`%c${r}`,`font-size: ${e}; background: ${s}; color: ${i}; padding: 4px 8px; border-radius: 5px; margin: 1px 0px;`)}([`lon: ${n}`,`lat: ${o}`,`hgt: ${l}`]),"function"==typeof t&&t({lon:n,lat:o,hgt:l})}}),i.ScreenSpaceEventType.LEFT_CLICK)}destroy(){this.handler=this.handler&&this.handler.destroy()}disable(){const t=this.Cesium;this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)}}class e{constructor(t,e){this.Cesium=t,this.viewer=e,this.tileset=null}load(t,e,i={}){const s=this.Cesium,r=this.viewer;return e=Object.assign({lon:116.391311,lat:39.90616,hgt:0,rx:0,ry:0,rz:0,scale:1},e),i=Object.assign(i,{url:t}),this.tileset=r.scene.primitives.add(new s.Cesium3DTileset(i)),this.tileset.readyPromise.then((()=>{const t=s.Cartesian3.fromDegrees(e.lon,e.lat,e.hgt),i=s.Transforms.eastNorthUpToFixedFrame(t),r=s.Matrix4.fromUniformScale(e.scale),a=s.Matrix3.fromRotationX(s.Math.toRadians(e.rx)),o=s.Matrix3.fromRotationY(s.Math.toRadians(e.ry)),n=s.Matrix3.fromRotationZ(s.Math.toRadians(e.rz)),l=s.Matrix4.fromRotationTranslation(a),h=s.Matrix4.fromRotationTranslation(o),c=s.Matrix4.fromRotationTranslation(n);s.Matrix4.multiply(i,r,i),s.Matrix4.multiply(i,l,i),s.Matrix4.multiply(i,h,i),s.Matrix4.multiply(i,c,i),this.tileset._root.transform=i})),this.tileset}locate(){this.viewer.zoomTo(this.tileset)}destroy(){this.tileset=this.tileset&&this.tileset.destroy()}}class i{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.container=null,this.inner=null,this.isShow=!0,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.canvas),this.init(i,s)}init(t,e){const i=this.Cesium,s=this.viewer,r={offset:{left:30,top:50},containerStyle:{display:"block",position:"absolute",maxWidth:"150px",minWidth:"100px",borderRadius:"4px",background:"#757575",color:"#fafafa",zIndex:"999"},innerStyle:{padding:"5px 8px",fontSize:"10px",fontWeight:"400"},isShowOnlyOnEarth:!0};Object.keys(r).forEach((t=>{"object"==typeof r[t]?Object.assign(r[t],e[t]):r[t]=e[t]})),this.container=document.createElement("div"),this.inner=document.createElement("div"),this.inner.innerHTML=t,Object.assign(this.container.style,r.containerStyle),Object.assign(this.inner.style,r.innerStyle),this.container.appendChild(this.inner),this.viewer.cesiumWidget.container.appendChild(this.container),this.handler.setInputAction((t=>{const e=s.camera.pickEllipsoid(t.endPosition,s.scene.globe.ellipsoid);this.isShow&&(e&&r.isShowOnlyOnEarth||!r.isShowOnlyOnEarth?(this.container.style.display="block",this.setPosition(t.endPosition,r.offset)):this.container.style.display="none")}),i.ScreenSpaceEventType.MOUSE_MOVE)}setPosition(t,e){this.container.style.left=t.x+e.left+"px",this.container.style.top=t.y-this.container.clientHeight/2+e.top+"px"}show(){this.isShow=!0,this.container.style.display="block"}hide(){this.isShow=!1,this.container.style.display="none"}destroy(){this.viewer.cesiumWidget.container.removeChild(this.container),this.handler=this.handler&&this.handler.destroy()}}function s(t,e,i){t.render();const s=i||"png";let r=t.scene.canvas.toDataURL(`image/${s}`).replace(`image/${s}`,"image/octet-stream"),a=document.createElement("a"),o=function(t){let e=t.split(","),i=e[0].match(/:(.*?);/)[1],s=atob(e[1]),r=s.length,a=new Uint8Array(r);for(;r--;)a[r]=s.charCodeAt(r);return new Blob([a],{type:i})}(r),n=URL.createObjectURL(o);a.download=e?`${e}.${s}`:`Scene-${(new Date).getTime()}.${s}`,a.href=n,a.click()}class r{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.pos=i,this.waterPolygon=null,this.defaultFloodOpts=null,this.floodOpts=s,this.initOpts()}initOpts(){this.defaultFloodOpts=Object.assign({waterHeight:0,targetWaterHeight:100,speed:1,waterColor:new Cesium.Color.fromBytes(64,157,250,120)},this.floodOpts)}startCallbackProperty(t){return new this.Cesium.CallbackProperty((()=>(this.defaultFloodOpts.waterHeight+=this.defaultFloodOpts.speed,this.defaultFloodOpts.waterHeight>this.defaultFloodOpts.targetWaterHeight?this.defaultFloodOpts.waterHeight=this.defaultFloodOpts.targetWaterHeight:t(this.defaultFloodOpts.waterHeight),this.defaultFloodOpts.waterHeight)),!1)}getCurrentWaterHeight(){return this.defaultFloodOpts.waterHeight}setCurrentWaterHeight(t){this.waterPolygon.polygon.extrudedHeight=new Cesium.CallbackProperty((()=>t),!1)}start(t){const e=this.Cesium,i=this.viewer;this.waterPolygon?this.waterPolygon.polygon.extrudedHeight=this.startCallbackProperty(t):this.waterPolygon=i.entities.add({polygon:{hierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArray(this.pos)),perPositionHeight:!0,extrudedHeight:this.startCallbackProperty(t),material:this.defaultFloodOpts.waterColor}})}pause(){const t=this.Cesium;this.waterPolygon.polygon.extrudedHeight=new t.CallbackProperty((()=>this.defaultFloodOpts.waterHeight),!1)}destroy(){this.viewer.entities.remove(this.waterPolygon),this.waterPolygon=null,this.initOpts()}}class a{constructor(t,e,i){this.Cesium=t,this.viewer=e,this.rotateOpts=i}addEvent(){this.viewer.clock.onTick.addEventListener(this.around,this)}removeEvent(){this.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.viewer.clock.onTick.removeEventListener(this.around,this)}start(){this.removeEvent(),this.addEvent()}pause(){this.removeEvent()}around(){const t=this.Cesium,e=this.viewer;let i=e.camera.heading;i+=t.Math.toRadians(this.rotateOpts.degrees),e.camera.lookAt(this.rotateOpts.position,new t.HeadingPitchRange(i,e.camera.pitch,this.rotateOpts.range))}}class o{constructor(t,e,i,s){this.Cesium=t,this.viewer=e,this.normalMapUrl=i,this.waterMaskOpts=s,this.waterMaskPrimitive=null}load(){const t=this.Cesium,e=this.viewer,i=Object.assign({baseWaterColor:new t.Color.fromBytes(64,157,250,60),frequency:200,animationSpeed:.002,amplitude:5,specularIntensity:1},this.waterMaskOpts),s=new t.PolygonGeometry({polygonHierarchy:new t.PolygonHierarchy(t.Cartesian3.fromDegreesArray(i.pos)),extrudedHeight:0,height:0,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),r=new t.GroundPrimitive({geometryInstances:new t.GeometryInstance({geometry:s}),appearance:new t.EllipsoidSurfaceAppearance({aboveGround:!0}),show:!0,classificationType:t.ClassificationType.TERRAIN});return r.appearance.material=new t.Material({fabric:{type:"Water",uniforms:{baseWaterColor:i.baseWaterColor,normalMap:this.normalMapUrl,frequency:i.frequency,animationSpeed:i.animationSpeed,amplitude:i.amplitude,specularIntensity:i.specularIntensity}}}),this.waterMaskPrimitive=e.scene.primitives.add(r),this.waterMaskPrimitive}destroy(){this.viewer.scene.primitives.remove(this.waterMaskPrimitive)}}export{e as Cesium3DTilesLoader,r as FloodAnalysis,t as PositionPicker,a as RotateAroundPoint,i as Tooltip,o as WaterMask,s as exportSceneAsImage};
